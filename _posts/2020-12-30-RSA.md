---
keywords: fastai
description: Implementation of RSA, Digital Signature and Certificates without divining too deep into the Mathematics; then list out key math principles for further reference. In this way, one can understand *what* and *how* as a context before drilling into *why*.
title: Python Implementation of RSA, Digital Signature and Certificates
toc: true
branch: master
badges: false
comments: true
categories: [jupyter, python, math]
hide: false
search_exclude: true
metadata_key1: metadata_value1
metadata_key2: metadata_value2
nb_path: _notebooks/2020-12-30-RSA.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-12-30-RSA.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Introduction">Introduction<a class="anchor-link" href="#Introduction"> </a></h2><p>Information is power. However, to transmit info is tricky. At least 2 issues need to be solved in information transmission: <strong>Security</strong> and <strong>Integrity</strong>.</p>
<ul>
<li><strong>Security (RSA)</strong></li>
</ul>
<p>No one can see the naked message other than the one intended.</p>
<ul>
<li><strong>Integrity (Digital Signature)</strong></li>
</ul>
<p>No one shall replace the message with another dummy one in the middle of transimission;<br>
If it happened, however, intended message receiver shall be able to find out.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Rivest,-Shamir-and-Adleman-(RSA)-Cryptosystem">Rivest, Shamir and Adleman (RSA) Cryptosystem<a class="anchor-link" href="#Rivest,-Shamir-and-Adleman-(RSA)-Cryptosystem"> </a></h2><p><img src="/blog/images/copied_from_nb/rsa_imgs/bg2013062702.jpg" alt="rsa">
@MIT</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Helper-Functions">Helper Functions<a class="anchor-link" href="#Helper-Functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Check-If-a-Number-is-Prime">Check If a Number is Prime<a class="anchor-link" href="#Check-If-a-Number-is-Prime"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open>
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">check_prime</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if num is prime</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># prime numbers are greater than 1</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># check for factors</span>
        <span class="c1"># TODO: refactoring to parallel</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># if input number is less than</span>
    <span class="c1"># or equal to 1, it is not prime</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Modular-Multiplicative-Inverse-Function">Modular Multiplicative Inverse Function<a class="anchor-link" href="#Modular-Multiplicative-Inverse-Function"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open>
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># https://stackoverflow.com/a/9758173/3317548</span>
<span class="k">def</span> <span class="nf">egcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">g</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">egcd</span><span class="p">(</span><span class="n">b</span> <span class="o">%</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span> <span class="o">//</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">modinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">egcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">g</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;modular inverse does not exist&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">aa</span> <span class="o">=</span> <span class="n">x</span> <span class="o">%</span> <span class="n">m</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">aa</span><span class="p">)</span> <span class="o">/</span> <span class="n">m</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="List-All-Prime-Numbers-Smaller-Than-a-Value">List All Prime Numbers Smaller Than a Value<a class="anchor-link" href="#List-All-Prime-Numbers-Smaller-Than-a-Value"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open>
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># https://stackoverflow.com/q/2068372/3317548</span>
<span class="k">def</span> <span class="nf">find_prime</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns  a list of primes &lt; n &quot;&quot;&quot;</span>
    <span class="n">sieve</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sieve</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="n">sieve</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">::</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">sieve</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Encryption-&amp;-Decryption-Process">Encryption &amp; Decryption Process<a class="anchor-link" href="#Encryption-&amp;-Decryption-Process"> </a></h3><ul>
<li>Receiver (Richael) generate a pair of keys: <strong>public</strong> &amp; <strong>private</strong></li>
<li>She keeps <strong>private</strong> key to herself confidentially</li>
<li>She sends multiple copies of <strong>public</strong> key to every of her friends who need to send her message</li>
<li>Any one got Richael's <strong>public</strong> key can send her message now. For instance, Stephen:  <ul>
<li>Stephen'd like to send the original message: "Hello Richael. Let's meet at 6:25 pm tomorrow at the airport Gate5, Terminal 2 :)", to Richael.</li>
<li>Stephen'd encrypt the message with Richaels <strong>public</strong> key into something looks random, e.g.  "MHgxNTMzCjB4MmFmNgoweGFiOA...YWE0CjB4MWZlMwoweDIzMGY="</li>
<li>Stephen'd send that "random" stuff to Richael.</li>
</ul>
</li>
<li>After receiving the "random" stuff from Stephen, Richael uses her own <strong>private</strong> key to decrypt it into orignal message "Hello Richael. How are you?!"</li>
<li>Only with Richael's <strong>private</strong> key, the "random" stuff, produced with Richael's <strong>public</strong> key, can be decrpted. Unless Richael shares her <strong>private</strong> key, which she shall never do, no one other than Richael herself can obtain the original message "Hello Richael. Let's meet at 6:25 pm tomorrow at the airport Gate5, Terminal 2 :)"</li>
<li>If Richael'd like to answer to Stephen, she must obtain Stephen's <strong>public</strong> key.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Key-Pair:-Public-&amp;-Private-(Richael's-Task)">Key Pair: Public &amp; Private (Richael's Task)<a class="anchor-link" href="#Key-Pair:-Public-&amp;-Private-(Richael's-Task)"> </a></h4><ul>
<li>Randomly pick 2 prime numbers (larger the better): <strong>p</strong> &amp; <strong>q</strong> </li>
<li>Got their muliplication: <strong>n=pxq</strong></li>
<li>Got the Euler number: <strong>phi=(p-1)x(q-1)</strong></li>
<li>Randomly find a prime number in the range of 1 to <strong>phi</strong> (larger the better): <strong>e</strong></li>
<li>Find the Modular Multiplicative Inverse of <strong>e</strong> relative to <strong>phi</strong>: <strong>k</strong></li>
<li>public key is: <strong>(n, e)</strong></li>
<li>private key is: <strong>(n, k)</strong></li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">find_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)))</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">find_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)))</span>
<span class="k">assert</span> <span class="n">check_prime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">check_prime</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span> <span class="nb">bin</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(503, 433, 217799, 20, &#39;0b110101001011000111&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">phi</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>216864</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">find_prime</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">check_prime</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="n">e</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>53201</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="n">modinv</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>172049</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">public_key</span><span class="p">,</span> <span class="n">private_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<span class="n">public_key</span><span class="p">,</span> <span class="n">private_key</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((217799, 53201), (217799, 172049))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Encryption-&amp;-Decryption-Computation">Encryption &amp; Decryption Computation<a class="anchor-link" href="#Encryption-&amp;-Decryption-Computation"> </a></h4><ul>
<li>Original message to unicode numbers: <strong>msg</strong></li>
<li>Encrypt message: <strong>msg_encrypt = (msg^e)%n</strong></li>
<li>Decrypt message: <strong>msg = (msg_encrypt^k)%n</strong></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Origial-Message-(Stephen's-Task)">Origial Message (Stephen's Task)<a class="anchor-link" href="#Origial-Message-(Stephen's-Task)"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># unicode</span>
<span class="n">msg</span> <span class="o">=</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s2">&quot;Hello Richael. Let&#39;s meet at 6:25 pm tomorrow at the airport Gate5, Terminal 2 --Stephen :)&quot;</span><span class="p">]</span>
<span class="n">msg</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[72,
 101,
 108,
 108,
 111,
 32,
 82,
 105,
 99,
 104,
 97,
 101,
 108,
 46,
 32,
 76,
 101,
 116,
 39,
 115,
 32,
 109,
 101,
 101,
 116,
 32,
 97,
 116,
 32,
 54,
 58,
 50,
 53,
 32,
 112,
 109,
 32,
 116,
 111,
 109,
 111,
 114,
 114,
 111,
 119,
 32,
 97,
 116,
 32,
 116,
 104,
 101,
 32,
 97,
 105,
 114,
 112,
 111,
 114,
 116,
 32,
 71,
 97,
 116,
 101,
 53,
 44,
 32,
 84,
 101,
 114,
 109,
 105,
 110,
 97,
 108,
 32,
 50,
 32,
 45,
 45,
 83,
 116,
 101,
 112,
 104,
 101,
 110,
 32,
 58,
 41]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Encrption-(Stephen's-Task)">Encrption (Stephen's Task)<a class="anchor-link" href="#Encrption-(Stephen's-Task)"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># encrption</span>
<span class="p">[(</span><span class="n">val</span> <span class="o">**</span> <span class="n">public_key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="n">public_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[162511,
 5181,
 55927,
 55927,
 115912,
 195281,
 111472,
 126581,
 68489,
 173057,
 166406,
 5181,
 55927,
 179566,
 195281,
 138221,
 5181,
 35563,
 172252,
 6992,
 195281,
 127699,
 5181,
 5181,
 35563,
 195281,
 166406,
 35563,
 195281,
 99457,
 79607,
 141608,
 32519,
 195281,
 178809,
 127699,
 195281,
 35563,
 115912,
 127699,
 115912,
 120104,
 120104,
 115912,
 89785,
 195281,
 166406,
 35563,
 195281,
 35563,
 173057,
 5181,
 195281,
 166406,
 126581,
 120104,
 178809,
 115912,
 120104,
 35563,
 195281,
 87206,
 166406,
 35563,
 5181,
 32519,
 174084,
 195281,
 177817,
 5181,
 120104,
 127699,
 126581,
 161923,
 166406,
 55927,
 195281,
 141608,
 195281,
 68985,
 68985,
 215883,
 35563,
 5181,
 178809,
 173057,
 5181,
 161923,
 195281,
 79607,
 50861]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">encry_msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">hex</span><span class="p">((</span><span class="n">val</span> <span class="o">**</span> <span class="n">public_key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="n">public_key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">])</span>
<span class="n">encry_msg</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;0x27acf\n0x143d\n0xda77\n0xda77\n0x1c4c8\n0x2fad1\n0x1b370\n0x1ee75\n0x10b89\n0x2a401\n0x28a06\n0x143d\n0xda77\n0x2bd6e\n0x2fad1\n0x21bed\n0x143d\n0x8aeb\n0x2a0dc\n0x1b50\n0x2fad1\n0x1f2d3\n0x143d\n0x143d\n0x8aeb\n0x2fad1\n0x28a06\n0x8aeb\n0x2fad1\n0x18481\n0x136f7\n0x22928\n0x7f07\n0x2fad1\n0x2ba79\n0x1f2d3\n0x2fad1\n0x8aeb\n0x1c4c8\n0x1f2d3\n0x1c4c8\n0x1d528\n0x1d528\n0x1c4c8\n0x15eb9\n0x2fad1\n0x28a06\n0x8aeb\n0x2fad1\n0x8aeb\n0x2a401\n0x143d\n0x2fad1\n0x28a06\n0x1ee75\n0x1d528\n0x2ba79\n0x1c4c8\n0x1d528\n0x8aeb\n0x2fad1\n0x154a6\n0x28a06\n0x8aeb\n0x143d\n0x7f07\n0x2a804\n0x2fad1\n0x2b699\n0x143d\n0x1d528\n0x1f2d3\n0x1ee75\n0x27883\n0x28a06\n0xda77\n0x2fad1\n0x22928\n0x2fad1\n0x10d79\n0x10d79\n0x34b4b\n0x8aeb\n0x143d\n0x2ba79\n0x2a401\n0x143d\n0x27883\n0x2fad1\n0x136f7\n0xc6ad&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">encry_msg</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encry_msg</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
<span class="n">encry_msg</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b&#39;MHgyN2FjZgoweDE0M2QKMHhkYTc3CjB4ZGE3NwoweDFjNGM4CjB4MmZhZDEKMHgxYjM3MAoweDFlZTc1CjB4MTBiODkKMHgyYTQwMQoweDI4YTA2CjB4MTQzZAoweGRhNzcKMHgyYmQ2ZQoweDJmYWQxCjB4MjFiZWQKMHgxNDNkCjB4OGFlYgoweDJhMGRjCjB4MWI1MAoweDJmYWQxCjB4MWYyZDMKMHgxNDNkCjB4MTQzZAoweDhhZWIKMHgyZmFkMQoweDI4YTA2CjB4OGFlYgoweDJmYWQxCjB4MTg0ODEKMHgxMzZmNwoweDIyOTI4CjB4N2YwNwoweDJmYWQxCjB4MmJhNzkKMHgxZjJkMwoweDJmYWQxCjB4OGFlYgoweDFjNGM4CjB4MWYyZDMKMHgxYzRjOAoweDFkNTI4CjB4MWQ1MjgKMHgxYzRjOAoweDE1ZWI5CjB4MmZhZDEKMHgyOGEwNgoweDhhZWIKMHgyZmFkMQoweDhhZWIKMHgyYTQwMQoweDE0M2QKMHgyZmFkMQoweDI4YTA2CjB4MWVlNzUKMHgxZDUyOAoweDJiYTc5CjB4MWM0YzgKMHgxZDUyOAoweDhhZWIKMHgyZmFkMQoweDE1NGE2CjB4MjhhMDYKMHg4YWViCjB4MTQzZAoweDdmMDcKMHgyYTgwNAoweDJmYWQxCjB4MmI2OTkKMHgxNDNkCjB4MWQ1MjgKMHgxZjJkMwoweDFlZTc1CjB4Mjc4ODMKMHgyOGEwNgoweGRhNzcKMHgyZmFkMQoweDIyOTI4CjB4MmZhZDEKMHgxMGQ3OQoweDEwZDc5CjB4MzRiNGIKMHg4YWViCjB4MTQzZAoweDJiYTc5CjB4MmE0MDEKMHgxNDNkCjB4Mjc4ODMKMHgyZmFkMQoweDEzNmY3CjB4YzZhZA==&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Decryption-(Richael's-Task)">Decryption (Richael's Task)<a class="anchor-link" href="#Decryption-(Richael's-Task)"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># base64 decode and hex decode</span>
<span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encry_msg</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[162511,
 5181,
 55927,
 55927,
 115912,
 195281,
 111472,
 126581,
 68489,
 173057,
 166406,
 5181,
 55927,
 179566,
 195281,
 138221,
 5181,
 35563,
 172252,
 6992,
 195281,
 127699,
 5181,
 5181,
 35563,
 195281,
 166406,
 35563,
 195281,
 99457,
 79607,
 141608,
 32519,
 195281,
 178809,
 127699,
 195281,
 35563,
 115912,
 127699,
 115912,
 120104,
 120104,
 115912,
 89785,
 195281,
 166406,
 35563,
 195281,
 35563,
 173057,
 5181,
 195281,
 166406,
 126581,
 120104,
 178809,
 115912,
 120104,
 35563,
 195281,
 87206,
 166406,
 35563,
 5181,
 32519,
 174084,
 195281,
 177817,
 5181,
 120104,
 127699,
 126581,
 161923,
 166406,
 55927,
 195281,
 141608,
 195281,
 68985,
 68985,
 215883,
 35563,
 5181,
 178809,
 173057,
 5181,
 161923,
 195281,
 79607,
 50861]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">decry_msg</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">**</span> <span class="n">private_key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="n">private_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encry_msg</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decry_msg</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decry_msg</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[72, 101, 108, 108, 111, 32, 82, 105, 99, 104, 97, 101, 108, 46, 32, 76, 101, 116, 39, 115, 32, 109, 101, 101, 116, 32, 97, 116, 32, 54, 58, 50, 53, 32, 112, 109, 32, 116, 111, 109, 111, 114, 114, 111, 119, 32, 97, 116, 32, 116, 104, 101, 32, 97, 105, 114, 112, 111, 114, 116, 32, 71, 97, 116, 101, 53, 44, 32, 84, 101, 114, 109, 105, 110, 97, 108, 32, 50, 32, 45, 45, 83, 116, 101, 112, 104, 101, 110, 32, 58, 41]
Hello Richael. Let&#39;s meet at 6:25 pm tomorrow at the airport Gate5, Terminal 2 --Stephen :)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Why-is-this-secure?">Why is this secure?<a class="anchor-link" href="#Why-is-this-secure?"> </a></h3><p><img src="/blog/images/copied_from_nb/rsa_imgs/euler.png" alt="Euler">
@Euler<br>
<em>He changed the world and he is now everywhere; Remeber Euler and everything about him, otherwise you'd fail at some stage of your life, some math exams for sure.</em></p>
<ul>
<li>If another friend of Richael, say Tom, would like to know what Stephen sent to Richael, without asking Stephen or Richael.</li>
<li>Another guy, say Joseph, was eavesdropping the network communication.</li>
<li>Either Tom or Joseph would already have access to information of: <ul>
<li><strong>n</strong> and <strong>e</strong> from public key because Richael broadcast it on the network to her friends.</li>
<li><strong>msg_encrypt</strong> because Stephen put it on the network for Richael to retrieve.</li>
</ul>
</li>
<li>In order to decrypt <strong>msg_encrypt</strong>, they need <strong>private key</strong> <strong>(n, k)</strong>;</li>
<li>They already have <strong>n</strong> so only need to figure out <strong>k</strong>.</li>
<li><strong>k</strong> was generated with <strong>e</strong> and <strong>phi</strong>.</li>
<li>They know <strong>e</strong>. So they only need to know <em>phi</em>. </li>
<li>They need <strong>p</strong> and <strong>q</strong> to know <strong>phi</strong></li>
<li>They know <strong>n</strong> which is the multiplication of prime numbers <strong>p</strong> and <strong>q</strong></li>
<li>Tom or Joseph need to do <strong>Prime Factorization</strong> as <strong>n=pxq</strong></li>
<li>Given <strong>n</strong> is large enough (1024 bits in nowadays common sense), Tom and Joseph would had been long gone before a modern computer, even they have access to <a href="https://en.wikipedia.org/wiki/TOP500">Fugaku</a>, could manage to figure out which 2 prime numebrs Richael picked at the first place, let along about by "6:25 pm tomrrow".</li>
<li>Richael may choose to update her key pairs frequently (change to different <strong>p</strong> and <strong>q</strong>) for the next message; this means Tom and Joseph can never catch up without a <a href="https://www.newscientist.com/article/2227387-quantum-computer-sets-new-record-for-finding-prime-number-factors/">Quantum Computer</a> on their hands.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Investigate-and-Understand-Your-Computer">Investigate and Understand Your Computer<a class="anchor-link" href="#Investigate-and-Understand-Your-Computer"> </a></h3><p>Now if go to <code>~/.ssh</code>, you shall identify a number of different key files. Some of them are private key whilst others are public key; some are generated by OpenSSH whilst others by OpenSSL. They are also encoded by ASN.1 format among some variates.</p>
<ul>
<li>You can convert it into <code>*.PEM</code> file via:  </li>
</ul>
<p><code>ssh-keygen -f YOUR_KEY.pub -e -m pem &gt; YOUR_KEY.pub.pem</code></p>
<ul>
<li>Then inspect the content via:</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">RSA</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>

<span class="n">pem_key</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;MII&lt;DO NOT SHARE PRIVATE KEY&gt;=&quot;</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">pem_key</span><span class="p">)</span>
<span class="n">keyPriv</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="c1"># key now has all the components of the private</span>
<span class="nb">print</span><span class="p">(</span><span class="n">keyPriv</span><span class="o">.</span><span class="n">keydata</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">keyPriv</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">keyPriv</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">keyPriv</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">keyPriv</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">keyPriv</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">keyPriv</span><span class="o">.</span><span class="n">u</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">keyPriv</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="n">keyPriv</span><span class="o">.</span><span class="n">q</span> <span class="o">==</span> <span class="n">keyPriv</span><span class="o">.</span><span class="n">n</span>
</pre></div>
<p>For public key <code>*.pub.pem</code>, it has only <code>keyPriv.n</code> and <code>keyPriv.e</code>.<br>
See: <a href="https://www.dlitz.net/software/pycrypto/api/2.6/Crypto.PublicKey.RSA-module.html">https://www.dlitz.net/software/pycrypto/api/2.6/Crypto.PublicKey.RSA-module.html</a></p>
<ul>
<li>Similarly, if you check <code>less ~/.ssh/known_hosts</code>, you shall see a number of lines of records, composing of:  </li>
</ul>
<p><code>&lt;domain_name,ip_address&gt; &lt;algorithm, e.g. ssh-rsa&gt; &lt;public_key&gt;</code></p>
<p>You can convert those <code>public_key</code> into <code>*.pem</code> like above and use the code snippet to check its content. You shall got <code>n</code> and <code>e</code>. When you send message to those servers, your message is encrypted with those <code>n</code> and <code>e</code>, and those server will use their private key to decrypt your message.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Digital-Signature">Digital Signature<a class="anchor-link" href="#Digital-Signature"> </a></h2><p>What if Joseph pretends to be Stephen, and sends Richael another message encrypted with Richaels public key, saying "Hello Richael. Let's meet at 6:25 am the day after tomorrow at the train station Gate 1 :)". How does Richael know the message is truly from Stephen, or being pretended by Joseph?</p>
<p>Another case would be Joseph intercepted Stephen's <strong>msg_encrypt</strong>, then modified/deleted/added some characters in that <em>random</em> stuff ("MHgxNTMzCjB4MmFmNgoweGFiO&gt;B&lt;...YWE0CjB4MWZlMwoweDIzMGY="), before sending to Rachael for decryption? Even though he cannot decrypt the message without Richael's private key, he can still alter it. For example, hiding some information about location:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">encry_msg_alter</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span>
            <span class="sa">b</span><span class="s2">&quot;MHgzMDJjZAoweDY0NzQ5CjB4NjYyM2QKMHg2NjIzZAoweDNjMTZkCjB4MmI1YWMKMHgzNjZjNgoweDM1ODJjCjB4MTQ4N2UKMHg0MDY0NQoweDE1YzQ0CjB4NjQ3NDkKMHg2NjIzZAoweDM4MWU3CjB4MmI1YWMKMHg0YjZhZAoweDY0NzQ5CjB4YWUzOQoweDQ3ZDc1CjB4NTYwYTYKMHgyYjVhYwoweDYwZDMKMHg2NDc0OQoweDY0NzQ5CjB4YWUzOQoweDJiNWFjCjB4MTVjNDQKMHhhZTM5CjB4MmI1YWMKMHg2MGU1YwoweDRkYjdkCjB4MjVkY2MKMHg0YjMzZQoweDJiNWFjCjB4NWI2ZTAKMHg2MGQzCjB4MmI1YWMKMHhhZTM5CjB4M2MxNmQKMHg2MGQzCjB4M2MxNmQKMHg0ZjNhOQoweDRmM2E5CjB4M2MxNmQKMHg2NzFiZgoweDJiNWFjCjB4MTVjNDQKMHhhZTM5CjB4MmI1YWMKMHhhZTM5CjB4NDA2NDUKMHg2NDc0OQoweDJiNWFjCjB4MTVjNDQKMHgzNTgyYwoweDRmM2E5CjB4NWI2ZTAKMHgzYzE2ZAoweDRmM2E5CjB4YWUzOQoweDJiNWFjCjB4MTk3OTgKMHgxNWM0NAoweGFlMzkKMHg2NDc0OQoweDRiMzNlCjB4NDZhNWIKMHgyYjVhYwoweDYxMjhhCjB4NjQ3NDkKMHg0ZjNhOQoweDYwZDMKMHgzNTgyYwoweGMxNGEKMHgxNWM0NAoweDY2MjNkCjB4MmI1YWMKMHgyNWRjYwoweDJiNWFjCjB4NGRiN2QKMHg1GFM5&quot;</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="mi">33</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">encry_msg_alter</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b&#39;MHgzMDJjZAoweDY0NzQ5CjB4NjYyM2QKMHg2NjIzZAoweDNjMTZkCjB4MmI1YWMKMHgzNjZjNgoweDM1ODJjCjB4MTQ4N2UKMHg0MDY0NQoweDE1YzQ0CjB4NjQ3NDkKMHg2NjIzZAoweDM4MWU3CjB4MmI1YWMKMHg0YjZhZAoweDY0NzQ5CjB4YWUzOQoweDQ3ZDc1CjB4NTYwYTYKMHgyYjVhYwoweDYwZDMKMHg2NDc0OQoweDY0NzQ5CjB4YWUzOQoweDJiNWFjCjB4MTVjNDQKMHhhZTM5CjB4MmI1YWMKMHg2MGU1YwoweDRkYjdkCjB4MjVkY2MKMHg0YjMzZQ==&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">decry_msg</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">**</span> <span class="n">private_key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="n">private_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encry_msg_alter</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decry_msg</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decry_msg</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[66670, 117840, 129574, 129574, 191038, 62355, 162284, 147181, 20313, 99002, 145613, 117840, 129574, 95630, 62355, 15309, 117840, 209107, 165660, 82583, 62355, 203720, 117840, 117840, 209107, 62355, 145613, 209107, 62355, 37326, 194931, 144730, 180998]
êëÆú±êü®¶ü®¶Æ®æÔéìßß¨£ª≠‰Ωôòä∫££çú±êü®¶óñéÔéì„Øçú±ê≥Éì®úúîäóÔéì±Øàú±êú±ê≥ÉìÔéì££ç≥ÉìÔéìÈáéØ•≥£ïö¨åÜ
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Two-Way-RSA">Two Way RSA<a class="anchor-link" href="#Two-Way-RSA"> </a></h3><p>Previously, we introduced only one-way RSA: everyone has Richael's <strong>public</strong> key. But Richael can also have others' <strong>public</strong> key, especially, the message sender Stephen's:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">find_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)))</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">find_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)))</span>
<span class="k">assert</span> <span class="n">check_prime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">check_prime</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span> <span class="nb">bin</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># Euler number</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">phi</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">find_prime</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">check_prime</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="n">e</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">modinv</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k</span>

<span class="n">public_key_stephen</span><span class="p">,</span> <span class="n">private_key_stephen</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<span class="n">public_key_stephen</span><span class="p">,</span> <span class="n">private_key_stephen</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((186331, 70949), (186331, 15781))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Hash">Hash<a class="anchor-link" href="#Hash"> </a></h3><p>Stephen will keep his <strong>private</strong> key to himself, but share the <strong>public</strong> key to his friends, including Richael. Before Stephen sends the message to Richael, he will also generate an <strong>abstract</strong> of the total message, e.g. with Hash:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">signature</span> <span class="o">=</span> <span class="n">sha256</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Hello Richael. Let&#39;s meet at 6:25 pm tomorrow at the airport Gate5, Terminal 2 --Stephen :)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<span class="n">signature</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;22edc929d9211d1102f7af88b85ea472c9e64629074985cba94607526dff3029&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now Stephen will encrypt this abstract with his <strong>private</strong> key:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">encry_sig</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="nb">hex</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">**</span> <span class="n">private_key_stephen</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="n">private_key_stephen</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">signature</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># base64 encode</span>
<span class="n">encry_sig</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encry_sig</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>
<span class="n">encry_sig</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b&#39;MHgyMGI1MAoweDIwYjUwCjB4MmE0MGMKMHgxMTVhMwoweDEzNWFiCjB4MTU1ODkKMHgyMGI1MAoweDE1NTg5CjB4MTE1YTMKMHgxNTU4OQoweDIwYjUwCjB4MTNlNDQKMHgxM2U0NAoweDExNWEzCjB4MTNlNDQKMHgxM2U0NAoweDcxNTkKMHgyMGI1MAoweDIwMTkxCjB4YjY0MAoweDI1YWQyCjB4MjAxOTEKMHg4MDgyCjB4ODA4MgoweDE0Zjc5CjB4ODA4MgoweDE4MjZhCjB4MmE0MGMKMHgyNWFkMgoweDliYTQKMHhiNjQwCjB4MjBiNTAKMHgxMzVhYgoweDE1NTg5CjB4MmE0MGMKMHhmNzhjCjB4OWJhNAoweGY3OGMKMHgyMGI1MAoweDE1NTg5CjB4NzE1OQoweGI2NDAKMHg5YmE0CjB4MTU1ODkKMHg4MDgyCjB4MTgyNmEKMHgxMzVhYgoweDE0Zjc5CjB4MjVhZDIKMHgxNTU4OQoweDliYTQKMHhmNzhjCjB4NzE1OQoweGI2NDAKMHgxODI2YQoweDIwYjUwCjB4Zjc4YwoweDExNWEzCjB4MjAxOTEKMHgyMDE5MQoweGRhZjgKMHg3MTU5CjB4MjBiNTAKMHgxNTU4OQ==&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, the message ready to be shipped to Richael by Stephen becomes:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">message_to_Richael</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">encry_msg</span><span class="p">,</span>
    <span class="s2">&quot;signature&quot;</span><span class="p">:</span> <span class="n">encry_sig</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">message_to_Richael</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;msg&#39;: b&#39;MHgyN2FjZgoweDE0M2QKMHhkYTc3CjB4ZGE3NwoweDFjNGM4CjB4MmZhZDEKMHgxYjM3MAoweDFlZTc1CjB4MTBiODkKMHgyYTQwMQoweDI4YTA2CjB4MTQzZAoweGRhNzcKMHgyYmQ2ZQoweDJmYWQxCjB4MjFiZWQKMHgxNDNkCjB4OGFlYgoweDJhMGRjCjB4MWI1MAoweDJmYWQxCjB4MWYyZDMKMHgxNDNkCjB4MTQzZAoweDhhZWIKMHgyZmFkMQoweDI4YTA2CjB4OGFlYgoweDJmYWQxCjB4MTg0ODEKMHgxMzZmNwoweDIyOTI4CjB4N2YwNwoweDJmYWQxCjB4MmJhNzkKMHgxZjJkMwoweDJmYWQxCjB4OGFlYgoweDFjNGM4CjB4MWYyZDMKMHgxYzRjOAoweDFkNTI4CjB4MWQ1MjgKMHgxYzRjOAoweDE1ZWI5CjB4MmZhZDEKMHgyOGEwNgoweDhhZWIKMHgyZmFkMQoweDhhZWIKMHgyYTQwMQoweDE0M2QKMHgyZmFkMQoweDI4YTA2CjB4MWVlNzUKMHgxZDUyOAoweDJiYTc5CjB4MWM0YzgKMHgxZDUyOAoweDhhZWIKMHgyZmFkMQoweDE1NGE2CjB4MjhhMDYKMHg4YWViCjB4MTQzZAoweDdmMDcKMHgyYTgwNAoweDJmYWQxCjB4MmI2OTkKMHgxNDNkCjB4MWQ1MjgKMHgxZjJkMwoweDFlZTc1CjB4Mjc4ODMKMHgyOGEwNgoweGRhNzcKMHgyZmFkMQoweDIyOTI4CjB4MmZhZDEKMHgxMGQ3OQoweDEwZDc5CjB4MzRiNGIKMHg4YWViCjB4MTQzZAoweDJiYTc5CjB4MmE0MDEKMHgxNDNkCjB4Mjc4ODMKMHgyZmFkMQoweDEzNmY3CjB4YzZhZA==&#39;,
 &#39;signature&#39;: b&#39;MHgyMGI1MAoweDIwYjUwCjB4MmE0MGMKMHgxMTVhMwoweDEzNWFiCjB4MTU1ODkKMHgyMGI1MAoweDE1NTg5CjB4MTE1YTMKMHgxNTU4OQoweDIwYjUwCjB4MTNlNDQKMHgxM2U0NAoweDExNWEzCjB4MTNlNDQKMHgxM2U0NAoweDcxNTkKMHgyMGI1MAoweDIwMTkxCjB4YjY0MAoweDI1YWQyCjB4MjAxOTEKMHg4MDgyCjB4ODA4MgoweDE0Zjc5CjB4ODA4MgoweDE4MjZhCjB4MmE0MGMKMHgyNWFkMgoweDliYTQKMHhiNjQwCjB4MjBiNTAKMHgxMzVhYgoweDE1NTg5CjB4MmE0MGMKMHhmNzhjCjB4OWJhNAoweGY3OGMKMHgyMGI1MAoweDE1NTg5CjB4NzE1OQoweGI2NDAKMHg5YmE0CjB4MTU1ODkKMHg4MDgyCjB4MTgyNmEKMHgxMzVhYgoweDE0Zjc5CjB4MjVhZDIKMHgxNTU4OQoweDliYTQKMHhmNzhjCjB4NzE1OQoweGI2NDAKMHgxODI2YQoweDIwYjUwCjB4Zjc4YwoweDExNWEzCjB4MjAxOTEKMHgyMDE5MQoweGRhZjgKMHg3MTU5CjB4MjBiNTAKMHgxNTU4OQ==&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Richael's-Verification">Richael's Verification<a class="anchor-link" href="#Richael's-Verification"> </a></h3><p>Now, what Richael will do is:</p>
<ul>
<li>Use her own <strong>private</strong> key to decrypt <strong>msg</strong></li>
<li>Use Stephen's <strong>public</strong> key to decrypt <strong>signature</strong></li>
<li>SHA256 Hash the decrypted <strong>msg</strong> to reproduce the <strong>signature</strong></li>
<li>Compare the 2 <strong>signatures</strong> and see if they match:<ul>
<li>if they do, the message is from Stephen and it is intact.</li>
<li>if not, something dodgy happened.</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">decry_msg</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">**</span> <span class="n">private_key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="n">private_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">message_to_Richael</span><span class="p">[</span><span class="s2">&quot;msg&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">decry_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decry_msg</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decry_msg</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Hello Richael. Let&#39;s meet at 6:25 pm tomorrow at the airport Gate5, Terminal 2 --Stephen :)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">decry_sig</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">**</span> <span class="n">public_key_stephen</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="n">public_key_stephen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">message_to_Richael</span><span class="p">[</span><span class="s2">&quot;signature&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decry_sig</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decry_sig</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[50, 50, 101, 100, 99, 57, 50, 57, 100, 57, 50, 49, 49, 100, 49, 49, 48, 50, 102, 55, 97, 102, 56, 56, 98, 56, 53, 101, 97, 52, 55, 50, 99, 57, 101, 54, 52, 54, 50, 57, 48, 55, 52, 57, 56, 53, 99, 98, 97, 57, 52, 54, 48, 55, 53, 50, 54, 100, 102, 102, 51, 48, 50, 57]
22edc929d9211d1102f7af88b85ea472c9e64629074985cba94607526dff3029
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sha256</span><span class="p">(</span>
    <span class="sa">b</span><span class="s2">&quot;Hello Richael. Let&#39;s meet at 6:25 pm tomorrow at the airport Gate5, Terminal 2 --Stephen :)&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decry_sig</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">sha256</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Hello Richael. Let&#39;s meet at 6:25&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decry_sig</span><span class="p">]</span>
<span class="p">),</span> <span class="s2">&quot;[Attention]: Dodgy thing happened with this message! Be CAREFULL!&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-25-a3fa67042ccb&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> assert sha256(b&#34;Hello Richael. Let&#39;s meet at 6:25&#34;).hexdigest() == &#34;&#34;.join(
<span class="ansi-green-intense-fg ansi-bold">      2</span>     <span class="ansi-blue-fg">[</span>chr<span class="ansi-blue-fg">(</span>i<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> decry_sig<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> ), &#34;[Attention]: Dodgy thing happened with this message! Be CAREFULL!&#34;
</span>
<span class="ansi-red-fg">AssertionError</span>: [Attention]: Dodgy thing happened with this message! Be CAREFULL!</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For Joseph, he can also have Stephen's <strong>public key</strong>, intercept and decrypt the signature. However, if now he wants to alter the message ("random" stuff) without being found out, he must alter the Hash ("22edc929d9211d1102f7af88b85ea472c9e64629074985cba94607526dff3029") as well and <strong>make sure they match</strong>. Without decrypting the original message, it is infeasible to generated its Hash. Therefore Joseph has 2 options: alter the message and being found out, or leave message as is.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">encry_sig</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="nb">hex</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">**</span> <span class="n">private_key_stephen</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="n">private_key_stephen</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">signature</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># base64 encode</span>
<span class="n">encry_sig</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encry_sig</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>
<span class="n">encry_sig</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b&#39;MHgyMGI1MAoweDIwYjUwCjB4MmE0MGMKMHgxMTVhMwoweDEzNWFiCjB4MTU1ODkKMHgyMGI1MAoweDE1NTg5CjB4MTE1YTMKMHgxNTU4OQ==&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">decry_sig</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">**</span> <span class="n">public_key_stephen</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="n">public_key_stephen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encry_sig</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decry_sig</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decry_sig</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[50, 50, 101, 100, 99, 57, 50, 57, 100, 57]
22edc929d9
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Certificate">Certificate<a class="anchor-link" href="#Certificate"> </a></h2><h3 id="Problem:">Problem:<a class="anchor-link" href="#Problem:"> </a></h3><p>Last issue: How do we trust those <strong>public</strong> keys received from different identities?</p>
<p>Joseph could totally generate his own key pair and pretend to be Richael. When Richael's friends receive the <strong>public key</strong>, how do they know it truly comes from Richael, rather than Joseph?</p>
<p>Joseph could also generate another pair of keys, sent the <strong>public</strong> key to Richael and claming it is from Stephen. How does Richael know the <strong>public</strong> key is truly from Stephen?</p>
<p>Without verification, Joseph hijacks the information transmission between Richael and Stephen.</p>
<h3 id="Solution:-Certificate-Authority-(CA)">Solution: Certificate Authority (CA)<a class="anchor-link" href="#Solution:-Certificate-Authority-(CA)"> </a></h3><p>CA is similar to the driving license issuer, e.g. Police Station or Government. They will verify identity of servers sharing their <strong>public</strong> key to other people and make sure it's genuine. For example:</p>
<ul>
<li>Stephen, to avoid being pretended by any other indiviudal like Joseph, must visit CA and show all his proof to convence CA that he is the real Stephen. </li>
<li>Once convenced, CA will take over Stephen's <strong>public</strong> key plus other personal information, e.g., name, birthday, address, etc, encrypt them with CA's <strong>private</strong> key, and issue back to Stephen. This is called <strong>Certificate</strong>.</li>
<li>When sending message to Richael, Stephen actually sends 3 things:<ol>
<li>Certificate Issued by CA</li>
<li>Message encrypted by Richael's <strong>public</strong> key</li>
<li>Message Signature encrypted by Stephen's <strong>private</strong> key</li>
</ol>
</li>
<li>When receiving message from Stephen, Richael does:<ol>
<li>Download the <strong>public</strong> key of CA and use it to decrypt <strong>Certificate</strong> included by Stephen. She will obtain the <strong>public</strong> key along with other identity information, for example, name, birthday, address, etc. </li>
<li>Only if she verified those information and confirm it's Stephen, this <strong>public</strong> key is used to decrypt the <strong>signature</strong>.</li>
<li>Decrypt the message with her own <strong>private</strong> key, and Hash it to reproduce the <strong>signature</strong>.</li>
<li>Compare the 2 <strong>signaure</strong> and see if they match.</li>
</ol>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">find_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)))</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">find_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)))</span>
<span class="k">assert</span> <span class="n">check_prime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">check_prime</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span> <span class="nb">bin</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># Euler number</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">phi</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">find_prime</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">check_prime</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="n">e</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">modinv</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k</span>

<span class="n">public_key_CA</span><span class="p">,</span> <span class="n">private_key_CA</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<span class="n">public_key_CA</span><span class="p">,</span> <span class="n">private_key_CA</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((436603, 212453), (436603, 199077))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stephen_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pub_key&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">public_key_stephen</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Stephen&quot;</span><span class="p">}</span>
<span class="nb">str</span><span class="p">(</span><span class="n">stephen_info</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#34;{&#39;pub_key&#39;: &#39;(186331, 70949)&#39;, &#39;name&#39;: &#39;Stephen&#39;}&#34;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">stephen_info</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;pub_key&#39;, &#39;name&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">certificate</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">certificate</span><span class="p">[</span><span class="s2">&quot;pub_key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="nb">hex</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">**</span> <span class="n">private_key_CA</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="n">private_key_CA</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">stephen_info</span><span class="p">[</span><span class="s2">&quot;pub_key&quot;</span><span class="p">]</span>
        <span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">certificate</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="nb">hex</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">**</span> <span class="n">private_key_CA</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">%</span> <span class="n">private_key_CA</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">stephen_info</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">certificate</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;pub_key&#39;: b&#39;MHgzZjYzMQoweDVhMWMwCjB4ZGE3YwoweDQxMDkxCjB4MjE3MzUKMHgyMTczNQoweDVhMWMwCjB4NWI3ZGEKMHgyNzFlZQoweGJjZAoweDgxM2UKMHg0ODg2MgoweDE0YmU5CjB4NDg4NjIKMHgyZDBjMA==&#39;,
 &#39;name&#39;: b&#39;MHgyOTk2YgoweDM5NWVlCjB4MjIyMDEKMHg1MTI3YwoweDNmMzVjCjB4MjIyMDEKMHhiMTU4&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">message_to_Richael</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cert&quot;</span><span class="p">:</span> <span class="n">certificate</span><span class="p">,</span>
    <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;MHgzMDJjZAoweDY0NzQ5CjB4NjYyM2QKMHg2NjIzZAoweDNjMTZkCjB4MmI1YWMKMHgzNjZjNgoweDM1ODJjCjB4MTQ4N2UKMHg0MDY0NQoweDE1YzQ0CjB4NjQ3NDkKMHg2NjIzZAoweDM4MWU3CjB4MmI1YWMKMHg0YjZhZAoweDY0NzQ5CjB4YWUzOQoweDQ3ZDc1CjB4NTYwYTYKMHgyYjVhYwoweDYwZDMKMHg2NDc0OQoweDY0NzQ5CjB4YWUzOQoweDJiNWFjCjB4MTVjNDQKMHhhZTM5CjB4MmI1YWMKMHg2MGU1YwoweDRkYjdkCjB4MjVkY2MKMHg0YjMzZQoweDJiNWFjCjB4NWI2ZTAKMHg2MGQzCjB4MmI1YWMKMHhhZTM5CjB4M2MxNmQKMHg2MGQzCjB4M2MxNmQKMHg0ZjNhOQoweDRmM2E5CjB4M2MxNmQKMHg2NzFiZgoweDJiNWFjCjB4MTVjNDQKMHhhZTM5CjB4MmI1YWMKMHhhZTM5CjB4NDA2NDUKMHg2NDc0OQoweDJiNWFjCjB4MTVjNDQKMHgzNTgyYwoweDRmM2E5CjB4NWI2ZTAKMHgzYzE2ZAoweDRmM2E5CjB4YWUzOQoweDJiNWFjCjB4MTk3OTgKMHgxNWM0NAoweGFlMzkKMHg2NDc0OQoweDRiMzNlCjB4NDZhNWIKMHgyYjVhYwoweDYxMjhhCjB4NjQ3NDkKMHg0ZjNhOQoweDYwZDMKMHgzNTgyYwoweGMxNGEKMHgxNWM0NAoweDY2MjNkCjB4MmI1YWMKMHgyNWRjYwoweDJiNWFjCjB4ZGMzCjB4ZGMzCjB4NWFmNTcKMHhhZTM5CjB4NjQ3NDkKMHg1YjZlMAoweDQwNjQ1CjB4NjQ3NDkKMHhjMTRhCjB4MmI1YWMKMHg0ZGI3ZAoweDlhMzk=&quot;</span><span class="p">,</span>
    <span class="s2">&quot;signature&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;MHgxOTQxMAoweDE5NDEwCjB4MTRiYWIKMHg2MTZjCjB4ZGFhCjB4MTJkMmIKMHgxOTQxMAoweDEyZDJiCjB4NjE2YwoweDEyZDJiCjB4MTk0MTAKMHg2OGEzCjB4NjhhMwoweDYxNmMKMHg2OGEzCjB4NjhhMwoweDE1MTA5CjB4MTk0MTAKMHgxNGEyNAoweGU4MWYKMHgxNDIyOAoweDE0YTI0CjB4MTk2NmQKMHgxOTY2ZAoweGIyMGEKMHgxOTY2ZAoweDE2YzY5CjB4MTRiYWIKMHgxNDIyOAoweDExMjYyCjB4ZTgxZgoweDE5NDEwCjB4ZGFhCjB4MTJkMmIKMHgxNGJhYgoweDE5MTI5CjB4MTEyNjIKMHgxOTEyOQoweDE5NDEwCjB4MTJkMmIKMHgxNTEwOQoweGU4MWYKMHgxMTI2MgoweDEyZDJiCjB4MTk2NmQKMHgxNmM2OQoweGRhYQoweGIyMGEKMHgxNDIyOAoweDEyZDJiCjB4MTEyNjIKMHgxOTEyOQoweDE1MTA5CjB4ZTgxZgoweDE2YzY5CjB4MTk0MTAKMHgxOTEyOQoweDYxNmMKMHgxNGEyNAoweDE0YTI0CjB4MTk1YTkKMHgxNTEwOQoweDE5NDEwCjB4MTJkMmI=&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Step 1: download CA&#39;s public key</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CA Public Key: &quot;</span><span class="p">,</span> <span class="n">public_key_CA</span><span class="p">)</span>

<span class="c1"># Step 2: verify Stephen&#39;s certificate with CA&#39;s public key</span>
<span class="n">public_key_st</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">**</span> <span class="n">public_key_CA</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="n">public_key_CA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">message_to_Richael</span><span class="p">[</span><span class="s2">&quot;cert&quot;</span><span class="p">][</span><span class="s2">&quot;pub_key&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">public_key_st</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">public_key_st</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stepen Public Key: &quot;</span><span class="p">,</span> <span class="n">public_key_st</span><span class="p">)</span>

<span class="n">name</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">**</span> <span class="n">public_key_CA</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="n">public_key_CA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">message_to_Richael</span><span class="p">[</span><span class="s2">&quot;cert&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">name</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CA Public Key:  (436603, 212453)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># RSA decode msg with Richael&#39;s private key</span>
<span class="n">decry_msg</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">**</span> <span class="n">private_key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="n">private_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">message_to_Richael</span><span class="p">[</span><span class="s2">&quot;msg&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">decry_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decry_msg</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decry_msg</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">decry_sig</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">**</span> <span class="n">public_key_st</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="n">public_key_st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">message_to_Richael</span><span class="p">[</span><span class="s2">&quot;signature&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decry_sig</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sha256</span><span class="p">(</span><span class="n">decry_msg</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decry_sig</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now as to Joseph, if still wants to pretend to be Stephen, would have 3 ways to go:</p>
<ol>
<li>Go to CA and try to convence them that he is the real Stephen, to have his fake <strong>public</strong> key certified, or</li>
<li>Manage to have access to CA's <strong>private</strong> key, so he can certify himself, or</li>
<li>Become a CA.</li>
</ol>
<p>Well...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reference">Reference<a class="anchor-link" href="#Reference"> </a></h2><ul>
<li><a href="https://blog.vrypan.net/2013/08/28/public-key-cryptography-for-non-geeks/">https://blog.vrypan.net/2013/08/28/public-key-cryptography-for-non-geeks/</a></li>
<li><a href="https://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">https://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html</a></li>
<li><a href="https://us-cert.cisa.gov/ncas/tips/ST04-018#:~:text=Digital%20signatures%20work%20by%20proving,using%20the%20sender&#39;s%20private%20key">https://us-cert.cisa.gov/ncas/tips/ST04-018#:~:text=Digital%20signatures%20work%20by%20proving,using%20the%20sender&#39;s%20private%20key</a>.</li>
</ul>

</div>
</div>
</div>
</div>
 

